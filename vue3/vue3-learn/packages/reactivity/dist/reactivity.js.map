{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/reactiveEffect.ts", "../src/baseHandler.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts", "../src/apiWatch.ts"],
  "sourcesContent": ["export const isObject = (val) => {\n    return typeof val === 'object' && val !== null\n}\n\nexport const isFunction = (val) => {\n    return typeof val === 'function'\n}", "import { DirtyLevels } from \"./constance\"\n\n// 1. \u5FC5\u5305\u7684\u573A\u666F \u89E3\u51B3 \u8BF7\u6C42\u987A\u5E8F\u7684\u95EE\u9898\n\nexport const effect = (fn, options) => {\n    // \u521B\u5EFA\u4E00\u4E2A \u54CD\u5E94\u5F0F\u7684 effect   \u6570\u636E\u53D8\u5316\u540E\u91CD\u65B0\u6267\u884C\n    const _effect = new ReactiveEffect(fn, () => {\n        _effect.run()\n    })\n   _effect.run()\n\n   // \u7528\u6237\u4F20\u7684 \u8986\u76D6\u9ED8\u8BA4\u7684 (\u7528\u6237\u7684 scheduler \u8986\u76D6\u9ED8\u8BA4\u7684 scheduler)\n   if(options){\n    Object.assign(_effect, options)\n   }\n\n   const runner = _effect.run.bind(_effect)\n\n   // \u5916\u9762\u53EF\u4EE5\u5728 run \u4E0A \u83B7\u53D6 effect \u7684\u5F15\u7528\n   runner.effect = _effect\n\n   // \u5916\u754C\u53EF\u4EE5\u624B\u52A8 run\n   return runner\n}\n\n\n// {flag: {effect}, name: {effect}}\n// {flag: {effect}, age: {effect}}\n// dep (new Map) \u91CC\u9762\u5220\u6389 effect\n// name \u6574\u4E2A map \u90FD\u5220\u6389\nconst cleanEffect = (oldDep, effect) => {\n    oldDep.delete(effect)\n\n    if(oldDep.size === 0){\n        oldDep.cleanup(); // \u5220\u9664\u8FD9\u4E2A\u5C5E\u6027\n    }\n}\n\nconst postCleanEffect = (effect) => {\n    // \u4EE5\u524D: [flag, name, xxx, yyy]\n    // \u4E4B\u540E: [flag]\n   if(effect.deps.length > effect._depsLength){\n        // \u4ECE \u7B2C\u4E8C\u4F4D\u5F00\u59CB\u5220\u9664\n        for (let index = effect._depsLength; index < effect.deps.length; index++) {\n            cleanEffect(effect.deps[index], effect)\n        }\n        // \u66F4\u65B0\u4F9D\u8D56\u5217\u8868\u7684\u957F\u5EA6\n        effect.deps.length = effect._depsLength\n   }\n}\n\nconst preCleanEffect = (effect) =>{\n    effect._depsLength = 0;\n    effect._trackId++ // \u540C\u4E00\u4E2A effect \u6267\u884C\uFF0C id \u662F \u76F8\u540C\u7684\n}\n\nexport let activeEffect;\nexport class ReactiveEffect {\n    // \u8BB0\u5F55 \u5F53\u524D\u7684 effect \u6267\u884C\u4E86 \u51E0\u6B21\n    _trackId = 0;\n\n    deps =[]\n    _depsLength = 0;\n    _running = 0\n\n    public active = true;\n\n    // \u9ED8\u8BA4\u810F\u503C\n    _dirtyLevel = DirtyLevels.DIRTY\n\n    // fn \u7528\u6237\u7F16\u5199\u7684\u51FD\u6570\n    // \u5982\u679C fn \u4E2D\u4F9D\u8D56\u7684\u6570\u636E\u53D1\u751F\u53D8\u66F4\uFF0C\u9700\u8981\u91CD\u65B0\u6267\u884C _effect.run()\n    constructor(public fn, public scheduler){}\n\n\n    public get dirty(){\n        return this._dirtyLevel === DirtyLevels.DIRTY\n    } \n    public set dirty(value){\n        this._dirtyLevel = value ?  DirtyLevels.DIRTY :  DirtyLevels.NODIRTY\n    }\n\n\n    run(){\n        // \u6BCF\u6B21 \u8FD0\u884C\u540E effect \u53D8\u4E3A \u4E0D\u810F\n        this._dirtyLevel = DirtyLevels.NODIRTY\n\n        debugger\n        if(!this.active){\n            // \u975E \u6FC0\u6D3B \u72B6\u6001\uFF0C\u6267\u884C\u540E\uFF0C\u4EC0\u4E48\u90FD\u4E0D\u9700\u8981\u505A\n            return this.fn()\n        }\n\n        let parentEffect = activeEffect\n        try{\n            activeEffect = this\n\n            // effect \u91CD\u65B0\u6267\u884C\u524D\uFF0C \u6E05\u7A7A\u4E0A\u4E00\u6B21\u7684 \u4F9D\u8D56 (\u6761\u4EF6\u6E32\u67D3)\n            preCleanEffect(this);\n\n            // \u901A\u8FC7 running \u6765\u5224\u65AD\u5F53\u524D\u662F\u5426\u5728\u8FD0\u884C\n            // \u5904\u7406 \u5FAA\u73AF\u8C03\u7528\u7684 \u95EE\u9898\n            this._running++;\n\n            // \u4F9D\u8D56\u6536\u96C6\n            return this.fn()\n        }finally{\n            // \u901A\u8FC7 running \u6765\u5224\u65AD\u5F53\u524D\u662F\u5426\u5728\u8FD0\u884C\n            this._running--;\n\n            postCleanEffect(this)\n            activeEffect = parentEffect\n        }  \n    }\n\n    stop(){\n        if(this.active){\n            this.active = false;\n            preCleanEffect(this)\n            postCleanEffect(this)\n        }\n    }\n}\n\n// _trackId \u7528\u4E8E\u8BB0\u5F55\u6267\u884C\u51E0\u6B21 (\u9632\u6B62\u4E00\u4E2A\u5C5E\u6027 \u5728 \u5F53\u524D effect \u591A\u6B21\u6536\u96C6)\uFF0C \u4E00\u4E2A effect \u53EA\u6536\u96C6\u4E00\u6B21\u5C5E\u6027 (\u5C5E\u6027\u5728\u4E00\u4E2A effect \u53CD\u590D\u4F7F\u7528\u7684\u8BDD)\n// \u62FF\u5230\u4E0A\u4E00\u6B21\u7684\u4F9D\u8D56\u7684 \u6700\u540E\u4E00\u4E2A \u548C \u8FD9\u6B21\u7684 \u6BD4\u8F83\n// {flag, name}\n// {flag, age}\nexport const trackEffect = (effect, dep)=> {\n    // \u4F18\u5316\u4E86\u591A\u4F59\u7684 \u4F9D\u8D56\u6536\u96C6 (\u5386\u53F2\u7248\u672C\u662F Set \u6240\u4EE5\u6CA1\u6709\u8FD9\u4E2A\u95EE\u9898)\n    debugger\n\n    // \u573A\u666F: state.flag + state.flag + state.flag, \n    // \u7B2C\u4E00\u6B21\u6267\u884C\u5B8C\u66F4\u65B0\u4E86  effect._trackId\uFF0C \u540E\u7EED\u5728 dep.get(effect) \u6CA1\u529E\u6CD5\u8FDB\u5165 if \u5224\u65AD\n    // \u7B2C\u4E00\u6B21 \u8FDB\u5165\u5230\u4E86 if \u91CC\u9762\n\n    // \u6BCF\u4E00\u6B21 \u53D6\u503C \u90FD\u89E6\u53D1 trackEffect\n\n    // \u573A\u666F: state.flag + state.flag + state.flag, \n    // \u7B2C\u4E00\u6B21 undefined 1  (\u8FD9\u91CC\u662F1 \u56E0\u4E3A\u6BCF\u6B21\u6E05\u7406\u90FD\u8D70\u4E86 preCleanEffect\uFF0C \u91CD\u7F6E\u4E86 _depsLength)\n    // \u7B2C\u4E8C\u6B21 1 1\n    // \u7B2C\u4E09\u6B21 1 1\n    if(dep.get(effect) !== effect._trackId){  // -> \u8FD9\u4E00\u884C \u89C4\u907F \u91CD\u590D\u6536\u96C6\u4F9D\u8D56 (\u540C\u4E00\u4E2A\u5C5E\u6027\u88AB \u53CD\u590D\u6536\u96C6)\n        dep.set(effect, effect._trackId) // \u66F4\u65B0 id\n\n\n        const oldDep = effect.deps[effect._depsLength]\n        // \u6CA1\u6709\u5B58\u8FC7\n        if(oldDep !== dep) {\n            if(oldDep){\n                // \u5220\u9664\u8001\u7684\n                cleanEffect(oldDep, effect)\n            }\n            effect.deps[effect._depsLength++] = dep\n        }else{\n            effect._depsLength++;\n        }\n\n    }\n\n    // \u6700\u539F\u59CB\u7684\u5199\u6CD5 -> \u6210\u4E3A \u4E0A\u9762\u7684\u5199\u6CD5\n    // dep.set(effect, effect._trackId)\n    // // effect \u548C dep \u8FDB\u884C\u5173\u8054\n    // effect.deps[effect._depsLength++] = dep\n}\n\nexport const triggerEffects = (dep) => {\n    for (const effect of dep.keys()) {\n\n        // \u670D\u52A1\u4E8E computed\n        // \u5F53\u524D\u8FD9\u4E2A\u503C\u4E0D\u810F\uFF0C\u4F46\u662F\u9700\u8981\u66F4\u65B0 \u628A\u5B83 \u53D8\u6210 \u810F\u503C\n        if (effect._dirtyLevel < DirtyLevels.DIRTY) {\n            effect._dirtyLevel = DirtyLevels.DIRTY\n        }\n        // \u670D\u52A1\u4E8E computed\n\n\n        // \u5F53\u524Deffect \u6B63\u5728\u8FD0\u884C\uFF0C\u4E0D\u9700\u8981\u89E6\u53D1\n        // \u5904\u7406 \u5FAA\u73AF\u8C03\u7528\u7684 \u95EE\u9898 (\u867D\u7136\u89C4\u907F\u4E86 \u6B7B\u5FAA\u73AF\u7684\u95EE\u9898\uFF0C\u4F46\u662F\u6709\u70B9 \u53CD\u7406\u89E3)\n        if(!effect._running){\n            if(effect.scheduler){\n                effect.scheduler() // ->\u89E6\u53D1 effect.run()\n            }\n        }\n    }\n}", "import { activeEffect, trackEffect, triggerEffects } from \"./effect\"\n\n\nexport const createDep = (cleanup, key) => {\n    const dep = new Map() as any;\n    \n    dep.cleanup = cleanup\n    dep.name = key\n\n    return dep\n} \n\nconst targetMap = new WeakMap();\n\n// \u901A\u8FC7 activeEffect \u5224\u65AD\u662F\u4E0D\u662F\u6D3B\u8DC3\u7684 effect\uFF0C \u975E \u6D3B\u8DC3\u7684 effect \u4E0D\u9700\u8981\u8FDB\u884C\u6536\u96C6\nexport const track = (target, key) => {\n    if(activeEffect){\n        \n        let depsMap = targetMap.get(target);\n        if(!depsMap){\n            targetMap.set(target, (depsMap = new Map()));\n        }\n\n        let dep = depsMap.get(key);\n        if(!dep){\n            // \u65B9\u4FBF \u540E\u7EED \u76F4\u63A5\u6E05\u7406\u6389 \u4F9D\u8D56\u7684 \u5C5E\u6027\u7684 dep \u96C6\u5408 (\u76F4\u63A5\u5220\u9664 age \uFF5C name \u4F9D\u8D56\u7684 dep \u96C6\u5408)\n            // \u6DFB\u52A0 key \u76EE\u7684  \u65B9\u4FBF\u8C03\u8BD5\n            depsMap.set(key, (dep = createDep(() => depsMap.delete(key), key) ));\n        }\n\n        \n        // \u628A \u5F53\u524D effect \u653E\u5230 dep \u91CC\u9762\uFF0C\u540E\u7EED\u53EF\u4EE5 \u89E6\u53D1 dep \u5B58\u653E\u7684 effect\n        trackEffect(activeEffect, dep)\n    }\n}\n\n\n\n// \u6700\u7EC8\u6536\u96C6\u7684\u6548\u679C -> WeakMap -> { obj: {name: Map(effect1, effect2), age: Map(effect1, effect2)}} }\n// {name: 1 ,age: 2} : {\n//     age: {\n//         effect1, effect2\n//     },\n//     name: {\n//         effect1\n//     }\n// }\n\n// age \u548C name \u5BF9\u5E94\u7684  Map \u4E0A\u5206\u522B\u5177\u6709 cleanup \u65B9\u6CD5\n\n\n\n\n\nexport const trigger = (target, key, value, oldValue) => {\n    \n    const depsMap = targetMap.get(target);\n\n    // \u6CA1\u627E\u5230\u4F9D\u8D56\u7684 effect \u76F4\u63A5 return\n    if(!depsMap){\n        return\n    }\n\n    // dep \u662F \u4E00\u4E2A new Map, \u91CC\u9762\u5B58\u653E\u7684\u662F effect  -> new Map({effect, effect._trackId})\n    let dep = depsMap.get(key);\n    if(dep){\n        triggerEffects(dep);\n    }\n}", "import { isObject } from \"@vue/shared\"\nimport { track, trigger } from \"./reactiveEffect\"\nimport { reactive } from \"./reactive\"\nimport { ReactiveFlags } from \"./constance\"\n\n\nexport const mutableHandlers: ProxyHandler<any> = {\n    get(target, key, receiver){\n        if(key === ReactiveFlags.IS_REACTIVE){\n            return true\n        }\n\n        // \u6536\u96C6\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u7684\u5C5E\u6027\uFF0C \u548C \u6D3B\u8DC3\u7684 effect \u5173\u8054\u5728\u4E00\u8D77\n        track(target, key)\n        \n        let res = Reflect.get(target, key, receiver)\n\n        // \u61D2\u4EE3\u7406\uFF0C \u53D6\u503C\u53D1\u73B0\u662F \u5BF9\u8C61 \u624D\u89E6\u53D1 \u4EE3\u7406\n        if(isObject(res)){\n            return reactive(res)\n        }\n        return res\n    },\n    set(target, key,value, receiver){\n\n        const oldValue = target[key]\n        let result = Reflect.set(target, key, value, receiver)\n\n        // \u503C\u4E0D\u4E00\u6837 \u89E6\u53D1\u66F4\u65B0\n        if(oldValue != value){\n            trigger(target, key, value, oldValue)\n        }\n       \n        return result\n    }\n}\n\n\n\n", "import { isObject } from \"@vue/shared\"\nimport { mutableHandlers } from \"./baseHandler\";\nimport { activeEffect } from \"./effect\";\nimport { ReactiveFlags } from \"./constance\"\n\n// \u7528\u4E8E\u8BB0\u5F55\u6211\u4EEC\u7684 \u4EE3\u7406\u540E\u7684\u7ED3\u679C\uFF0C\u53EF\u4EE5\u590D\u7528 \nconst reactiveMap = new WeakMap();\n\nexport const createReactiveObject = (target) => {\n    // \u7EDF\u4E00\u505A\u51FA\u5224\u65AD\uFF0C \u54CD\u5E94\u5F0F\u5BF9\u8C61 \u5FC5\u987B\u662F\u5BF9\u8C61\u624D\u884C\n    if(!isObject(target)){\n        return target\n    }\n\n    // \u5904\u7406\u88AB\u4EE3\u7406\u7684\u5BF9\u8C61\u5728\u6B64\u88AB\u4EE3\u7406\u7684\u60C5\u51B5\n    if(target[ReactiveFlags.IS_REACTIVE]){\n        return target\n    }\n\n    const exitsProxy = reactiveMap.get(target)\n    if(exitsProxy){\n        return exitsProxy\n    }\n\n    let proxy = new Proxy(target, mutableHandlers)\n    // \u4EE3\u7406\u7684\u5BF9\u8C61\u88AB\u7F13\u5B58\uFF0C\u9632\u6B62\u540C\u4E00\u4E2A\u5BF9\u8C61\u88AB\u53CD\u590D\u4EE3\u7406\u7684\u95EE\u9898\n    reactiveMap.set(target, proxy)\n\n    return proxy\n}\n\nexport const reactive = (target) => {\n    return createReactiveObject(target)     \n}\n\nexport const toReactive = (value) => {\n    return isObject(value) ? reactive(value) : value\n}\n\nexport const isReactive = (value) => {\n    return !!(value && value[ReactiveFlags.IS_REACTIVE])\n}", "import { activeEffect, trackEffect, triggerEffects } from \"./effect\";\nimport { toReactive } from \"./reactive\";\nimport { createDep } from \"./reactiveEffect\";\n\nexport const ref = (value) => {\n    return createRef(value)\n}\n\nexport const createRef = (value) => {\n    return new RefImpl(value)\n}\n\nexport class RefImpl{\n    // \u589E\u52A0 ref \u6807\u8BC6\n    public __v_isRef = true;\n\n    // \u7528\u6765\u4FDD\u5B58 ref \u7684\u503C\n    public _value;\n\n    // \u6536\u96C6\u5BF9\u5E94\u7684 effect (\u76F8\u5F53\u4E8E ref \u8BB0\u4F4F\u4E86 effect)\n    public dep\n\n    constructor(public rawValue) {\n        this._value = toReactive(this.rawValue)\n    }\n\n    get value() {\n        trackRefValue(this)\n        return this._value\n    }\n\n    set value(newValue) {\n        if (newValue !== this.rawValue) {\n            this.rawValue = newValue\n            this._value = newValue\n            triggerRefValue(this)\n        }\n    }\n}\n\nexport const trackRefValue = (ref) => {\n    // \u6709\u6D3B\u8DC3\u7684 effect \u624D\u8FDB\u884C \u6536\u96C6\uFF0C \u6240\u4EE5\u8FD9\u91CC\u9700\u8981\u8FDB\u884C\u5224\u65AD\n    // \u56E0\u4E3A ref \u7684\u53D6\u503C \u5728 effect() \u6267\u884C \u624D\u6B63\u5E38\u8FDB\u884C \u4F9D\u8D56\u6536\u96C6\n    if(activeEffect){\n        // ref.dep \u6709\u503C \u76F4\u63A5\u590D\u7528\uFF0C\u4E0D\u9700\u8981 \u518D\u6B21\u521B\u5EFA (\u5426\u5219\u4F1A\u4E22\u5931\u4E0A\u4E00\u6B21\u7684\u5DF2\u7ECF\u6536\u96C6 \u597D\u7684 \u4F9D\u8D56)\n        trackEffect(activeEffect, (ref.dep = ref.dep || createDep(() => ref.dep = undefined, 'undefined')))\n    }\n}\n\nexport const triggerRefValue = (ref) => {\n    let dep = ref.dep\n    if(dep){\n        triggerEffects(dep)\n    }\n}\n\n\n\n\n// toRef\nclass ObjectRefImpl{\n    // \u589E\u52A0 ref \u6807\u8BC6\n    public __v_isRef = true\n    \n    constructor(public _obj, public _key){}\n\n    get value(){\n        return this._obj[this._key]\n    }\n\n    set value(newValue){\n        this._obj[this._key] = newValue\n    }\n}\n\nexport const toRef = (obj, key) => {\n    return new ObjectRefImpl(obj, key)\n}\n\n\n\n\n// toRefs\nexport const toRefs = (obj) => {\n    const res = {}\n    for (const key in obj) {\n        res[key] = new ObjectRefImpl(obj, key)\n    }\n    return res\n}\n\n\n\n\n// proxyRefs\nexport const proxyRefs = (objectWithRef) => {\n    debugger\n    return new Proxy(objectWithRef, {\n        get(target, key, receiver) {\n            const r = Reflect.get(target, key, receiver)\n\n            return r.__v_isRef ? r.value : r\n        },\n        set(target, key, value) {\n            const oldVal = target[key]\n\n            if (oldVal.__v_isRef) {\n                oldVal.value = value\n                return true\n            } else {\n                return Reflect.set(target, key, value,)\n            }\n        }\n    })\n}", "import { isFunction } from \"@vue/shared\"\nimport { ReactiveEffect } from \"./effect\"\nimport { trackRefValue, triggerRefValue } from \"./ref\"\n\n// 1. \u8BA1\u7B97\u5C5E\u6027\u672C\u8EAB\u5C31\u662F\u4E00\u4E2A effect\uFF0C \u9ED8\u8BA4\u662F\u810F\u7684\n// 2. \u5F53\u8BBF\u95EE computed.value \u89E6\u53D1\u4E86 \u4F9D\u8D56\u6536\u96C6\uFF0Ccomputed() \u91CC\u9762\u7684 \u5C5E\u6027 \u4E0E computed effect \u8FDB\u884C\u4E86\u5173\u8054 \n\n// **\u53D6\u503C**: (\u4F18\u5148\u6267\u884C \u6E32\u67D3 effect -> renderEffect.run() -> \u89E6\u53D1 computed.get Value() -> computed.fn(`() => getter(this._value)`) ->\n// -> \u89E6\u53D1\u7528\u6237\u81EA\u5B9A\u4E49 computed cb -> \u89E6\u53D1 \u54CD\u5E94\u5F0F\u6570\u636E\u7684 \u4F9D\u8D56\u6536\u96C6) \u6B64\u65F6 activeEffect \u4E3A computed effect\u3002\n\n// \u5E2E\u52A9\u7406\u89E3 --> \u8C01 run activeEffect \u662F\u8C01\uFF0C computed get value() \u7684  this.effect.run() \u6267\u884C\u5B8C\u6BD5\uFF0C\u6B64\u65F6 activeEffect \u662F render Effect\n// computed effect \u91CC\u9762\u7684 dep \u5B58\u653E\u7684\u662F render effect (render effect \u6267\u884C \u89E6\u53D1 render effect \u7528\u6237\u81EA\u5B9A\u4E49 cb \u6267\u884C ->\n// \u89E6\u53D1 computed.value \u5C5E\u6027 -> computed get value(), \u6B64\u65F6 activeEffect \u662F render Effect)\n\n// **\u6539\u503C**: \u89E6\u53D1\u4E86  computed effect \u7684 scheduler -> computed \u7684 triggerRefValue -> \u89E6\u53D1 render effect.run()\n\nclass ComputedImpl{\n    // \u8BB0\u5F55\u4E0A\u4E00\u6B21\u7684\u503C\n    public _value\n    public dep \n\n    public effect\n    constructor(public getter, public setter){\n        debugger\n        // \u521B\u5EFA effect \u6765\u8BA1\u7B97\u5F53\u524D\n        this.effect = new ReactiveEffect(() => getter(this._value), () => {\n            // \u8BA1\u7B97\u5C5E\u6027\u53D1\u751F\u53D8\u66F4\uFF0C\u89E6\u53D1 effect \u91CD\u65B0\u6267\u884C\n            triggerRefValue(this)\n        })\n    }\n\n    get value(){\n        if(this.effect.dirty){\n            // \u9ED8\u8BA4\u662F\u810F\u7684\uFF0C \u53D6\u503C\u5B8C\u6210\u4E4B\u540E\u5C31\u662F \u4E0D\u810F\u7684\uFF0C \u540E\u7EED\u76F4\u63A5 return \u503C\n            this._value = this.effect.run()\n\n            // \u5982\u679C\u5F53\u524D effect \u8BBF\u95EE\u4E86\u8BA1\u7B97\u5C5E\u6027\uFF0C \u8BA1\u7B97\u5C5E\u6027\u9700\u8981\u6536\u96C6\u8FD9\u4E2A effect\n            trackRefValue(this)\n        }\n        return this._value\n    }\n    set value(newValue){\n        this.setter(newValue)\n    }\n}\n\nexport const computed = (getterOrOptions) => {\n    let onlyFn = isFunction(getterOrOptions)\n\n    let getter\n    let setter\n    if(onlyFn){\n        getter = getterOrOptions\n        setter = () => {\n            console.warn('computed is readonly')\n        }\n    }else{\n        getter = getterOrOptions.get\n        setter = getterOrOptions.set\n    }\n\n    return new ComputedImpl(getter, setter)\n}", "import { isObject } from \"@vue/shared\"\nimport { ReactiveEffect } from \"./effect\"\nimport { isReactive } from \"./reactive\"\n\nexport const watch = (source, cb, options) => {\n    return doWatch(source, cb, options)\n}\n\nexport const watchEffect = (source, options) => {\n    return doWatch(source, null, options)\n}\n\n// watchEffect \u4E5F\u662F\u57FA\u4E8E doWatch \u5B9E\u73B0\nconst doWatch = (source, cb, { immediate, deep, flush }) => {\n\n    // source \u5FC5\u987B\u662F\u54CD\u5E94\u5F0F\u6570\u636E\uFF0C \u5426\u5219\u6CA1\u6709\u610F\u4E49\n    const reactiveGetter = (source) => traverse(source, deep === false ? 1 : undefined )\n   \n    let clean\n    const onCleanUp = (fn) => {\n        clean = () => {\n            fn()\n            clean = undefined\n        }\n    }\n\n    let oldVal\n    const job = () => {\n        if(cb){\n            const newVal = effect.run()\n\n            if(clean){\n                clean() // \u4E0B\u4E00\u6B21\u8C03\u7528\u4E4B\u524D \u6E05\u7406\u4E0A\u4E00\u6B21\u7684\u526F\u4F5C\u7528\n            }\n\n            cb(oldVal, newVal, onCleanUp)\n            oldVal = newVal\n        }else{\n            effect.run()\n        }\n    }\n\n    let getter\n    if(isReactive(source)){\n        getter = () => {\n            reactiveGetter(source)\n        }\n    }\n    const effect = new ReactiveEffect(getter, job)\n\n    if(cb){\n        oldVal = effect.run()\n    }else{\n        effect.run()\n    }\n\n    const unwatch = () => { effect.stop() }\n    return unwatch\n}\n\nconst traverse = (source, depth, currentDepth = 0, seen = new Set()) => {\n    if(!isObject(source)){\n        return\n    }\n    if(depth){\n        if(currentDepth >= depth){\n            return source\n        }\n        currentDepth++\n    }\n    if(seen.has(source)){\n        return source\n    }\n\n    // \u904D\u5386 \u89E6\u53D1 \u6BCF\u4E2A\u5C5E\u6027\u7684 get\n    for (const key in source) {\n        traverse(source[key], depth, currentDepth, seen)\n    }\n    return source\n}\n\n"],
  "mappings": "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",
  "names": ["effect", "ref", "source", "effect"]
}
